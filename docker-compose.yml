version: '3'

services:
    db: 
        image: postgres
        volumes:
              - ./postgres-data:/var/lib/postgresql/data
    web:
        build: .
        command: bash -c "(cd static/semantic/ && gulp build && cd ../../ && python3 manage.py migrate && python3 manage.py collectstatic); ((cd static/semantic/ && gulp watch) & gunicorn --bind 0.0.0.0:8000 enceph.wsgi)"
        volumes: 
            - .:/code
        ports:
            - "8000:8000"
        depends_on:
            - db
