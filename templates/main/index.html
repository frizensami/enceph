{% load static %}

<head>
    <link rel="stylesheet" type="text/css" href="{% static '/main/style.css' %}">
    <link rel="stylesheet" type="text/css" href="{% static '/semantic/dist/semantic.min.css' %}">
    <meta charset="utf-8">
    <title>Encephalocosm</title>
    <meta name="description" content="">
    <meta name=viewport content="width=device-width, initial-scale=1">
    <meta name="mobile-web-app-capable" content="yes">
    <script src="{% static '/jquery-3.1.1.min.js' %}"></script>
    <script src="{% static '/semantic/dist/semantic.min.js' %}"></script>
    <script src="{% static '/main/tablesort.js' %}"></script>
</head>

<body>
    <script>
        $(document).ready(function () {
            // tablesort.js - allow sorting of table through headers
            console.log("DOM Loaded - loading tablesort");
            $('table').tablesort();

            $('.label.ui.dropdown')
                .dropdown();

            $('.no.label.ui.dropdown')
                .dropdown({
                    useLabels: false
                });

            // To reset categories: comment out when ready again
            $('#clear-filters').on('click', function () {
                $('.ui.dropdown')
                    .dropdown('restore defaults')
            })

            /*
            // To reset categories: comment out when ready again
            $('#apply-filters').on('click', function () {
                $.get('/');
            })
            */

            // Controls new tool entry form modal and button
            $("#test").click(function () {
                $(".test").modal('show');
            });
            $(".test").modal({
                closable: true
            });
            $('.ui.form')
                .form({
                    fields: {
                        tool_name: { rules: [{ type: 'empty', prompt: 'You must specify a tool name' }] },
                        tool_link: { rules: [{ type: 'empty', prompt: 'You must specify a link to the tool' }, { type: 'url', prompt: 'This link to the tool must be a valid url' }] },
                        tool_description: { rules: [{ type: 'empty', prompt: 'You must provide a description of the tool' }] },
                        tool_logo_link: { rules: [{ type: 'empty', prompt: 'You must specify a link to the image of the logo of the tool' }, { type: 'url', prompt: 'This link to the logo of the tool must be a valid url' }] },
                        tool_categories: { rules: [{ type: 'empty', prompt: 'You must specify at least one category that this tool fits into' }] },
                    }
                });

            // this is the id of the form
            $("#new-tool-form").submit(function (e) {
                if ($('#new-tool-form').form('is valid')) {
                    var form = $(this);
                    var url = '/new_tool';


                    $.ajax({
                        type: "POST",
                        url: url,
                        data: form.serialize(), // serializes the form's elements.
                        success: function (data) {
                            alert(data); // show response from the php script.
                        },
                        error: function (xhr, textStatus, errorThrown) {
                            alert('Form validation error on server: ' + errorThrown);
                        },
                    });
                }


                e.preventDefault(); // avoid to execute the actual submit of the form.
            });

        });


    </script>

    <div class="ui center aligned container" style="margin-top: 5px">
        <img class="ui tiny centered image" src="{% static '/site-logo-50.png' %}">
        <h1 class="ui header" style="margin-bottom: 0px; margin-top: 0px"> Encephalocosm </h1>
        <p style="margin-bottom: 0px; margin-top: 5px"> (en-ceph-a-lo-cosm)</p>
        <h4 style="margin-bottom: 0px; margin-top: 5px"> Making science accessible, and academia simpler.</h4>

        <div class="ui divider"> </div>

        <div class="ui padded raised blue segment">
            <h2> Open Science Tools Directory </h2>

            <div id="control-buttons">
                <button class="ui labeled primary icon button" id="test">
                    <i class="plus icon"></i>
                    Submit new tool
                </button>



                <br>
                <br>




                <div class="ui centered  raised segment">

                    <h4> Select filters for the available tools </h4>
                    <form class="ui form" action="/" method="GET">
                        <div class="ui stackable grid">
                            <div class="twelve wide column">
                                <div class="field">
                                    <select name="categories_filter" multiple="" class="ui label fluid large selection search dropdown">
                                        <!-- <option value="1">Change Methodology</option> -->
                                        <option value="" disabled selected> Select categories to filter </option>
                                        {% for category in categories %}
                                        <option value="{{ category.id }}">{{ category.name }}</option>
                                        {% endfor %}
                                    </select>
                                </div>
                            </div>
                            <div class="four wide column">
                                <div class="ui large fluid button" id="clear-filters"> Clear </div>

                            </div>

                        </div>
                        <div class="ui segment">
                            <br>
                            <div class="ui center aligned grid">

                                <div class="row">
                                    <h5>Filter target audience of tool</h5>
                                </div>
                                <div class="row" style="padding-top: 0px; padding-bottom: 0px">
                                    <div class="inline fields">
                                        <div class="field">
                                            <div class="ui slider checkbox">
                                                <input type="radio" name="targetaudience" checked="checked" value="all">
                                                <label>All</label>
                                            </div>
                                        </div>
                                        <div class="field">
                                            <div class="ui slider checkbox">
                                                <input type="radio" name="targetaudience" value="researchers">
                                                <label>For Researchers</label>
                                            </div>
                                        </div>
                                        <div class="field">
                                            <div class="ui slider checkbox">
                                                <input type="radio" name="targetaudience" value="developers">
                                                <label>For Developers</label>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="row">
                                    <h5>Filter state of development of tool</h5>
                                </div>
                                <div class="row" style="padding-top: 0px !important">
                                    <div class="inline fields">
                                        <div class="field">
                                            <div class="ui slider checkbox">
                                                <input type="radio" name="devstate" checked="checked" value="all">
                                                <label>All</label>
                                            </div>
                                        </div>
                                        <div class="field">
                                            <div class="ui slider checkbox">
                                                <input type="radio" name="devstate" value="beta">
                                                <label>In Beta</label>
                                            </div>
                                        </div>
                                        <div class="field">
                                            <div class="ui slider checkbox">
                                                <input type="radio" name="devstate" value="released">
                                                <label>Released</label>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="two wide column">
                            <input type="submit" value="Apply Selected Filters" class="ui green button" />
                        </div>
                    </form>


                </div>

            </div>

            <table class="ui sortable celled padded large table">
                <thead>
                    <tr>
                        <th>Name</th>
                        <th>Description</th>
                        <th>Categories</th>
                        <th>Added On</th>
                        <th>For Devs?</th>
                        <th>In Beta?</th>
                    </tr>
                </thead>
                <tbody>
                    {% for tool in tools %}
                    <tr>
                        <td>
                            <a href="{{ tool.link }}">{{ tool.name }}</a>
                        </td>
                        <td>{{ tool.description }}</td>
                        <td>{{ tool.categories.all|join:", " }}</td>
                        <td data-sort-value='{{ tool.updated_at |date:"U" }}'>
                            {{ tool.updated_at |date:"jS M Y" }}
                        </td>
                        <td>{{ tool.is_for_developers|yesno:"Yes,No" }}</td>
                        <td>{{ tool.is_beta|yesno:"Yes,No" }}</td>
                        {% endfor %}
                    </tr>
                </tbody>
                <!--
                <tfoot>
                    <tr>
                        <th colspan="5">
                            <div class="ui right floated pagination menu">
                                <a class="icon item">
                                    <i class="left chevron icon"></i>
                                </a>
                                <a class="item">1</a>
                                <a class="item">2</a>
                                <a class="item">3</a>
                                <a class="item">4</a>
                                <a class="icon item">
                                    <i class="right chevron icon"></i>
                                </a>
                            </div>
                        </th>
                    </tr>
                </tfoot>
            -->
            </table>

        </div>


    </div>

    <!-- This is our add-tool popup -->
    <div class="ui modal test">
        <div class="ui aligned grid">
            <div class="column">
                <h2 class="ui center aligned blue header" style="margin-top: 20px">
                    <!-- <img src="{% static '/site-logo-25.png' %}" class="image"> -->
                    <div class="content">
                        Submit tool to directory for approval
                    </div>
                </h2>
                <form class="ui large form" id="new-tool-form">
                    {% csrf_token %}
                    <div class="ui segment">
                        <div class="field">
                            <div class="ui left icon input">
                                <i class="edit icon"></i>
                                <input type="text" name="tool_name" placeholder="Tool name">
                            </div>
                        </div>
                        <div class="field">
                            <div class="ui left icon input">
                                <i class="linkify icon"></i>
                                <input type="text" name="tool_link" placeholder="URL link to tool">
                            </div>
                        </div>
                        <div class="field">
                            <div class="ui left icon input">
                                <!--<i class="linkify icon"></i> -->
                                <textarea name="tool_description" placeholder="Description of tool"></textarea>
                            </div>
                        </div>
                        <div class="field">
                            <select id="tool_categories" name="tool_categories" multiple="" class="ui label selection fluid large search dropdown">
                                <option value="" disabled selected>Select categories that this tool fits
                                    into </option>

                                {% for category in categories %}
                                <option value="{{ category.id }}">{{ category.name }}</option>
                                {% endfor %}
                            </select>
                        </div>
                        <div class="field">
                            <div class="ui toggle checkbox">
                                <input type="checkbox" name="tool_is_for_developers">
                                <label>Is this tool for developers only? (By default, tools are listed as for
                                    researchers)</label>
                            </div>
                        </div>
                        <div class="field">
                            <div class="ui toggle checkbox">
                                <input type="checkbox" name="tool_is_beta">
                                <label>Is this tool in beta? (By default, tools are listed as being in a released
                                    state)</label>
                            </div>
                        </div>


                        <div class="ui error message">
                        </div>

                        <input type="submit" value="Submit Tool" class="ui button center aligned fluid primary" />



                    </div>

                </form>

            </div>
        </div>
    </div>

    <div class="ui vertical footer segment">
        <div class="ui center aligned container">
            Encephalocosm (2018)
        </div>
    </div>
</body>